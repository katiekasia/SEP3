@* @page "/bookingPageTest" *@
@* @using PatientFinal.DTOs *@
@* @using PatientFinal.Services *@
@* @inject HttpClient Http *@
@* @inject IAppointmentService AppointmentService *@
@* *@
@* <PageTitle>Book Appointment</PageTitle> *@
@* <h3>Book an Appointment</h3> *@
@* *@
@* @if (!showConfirmation) // This will hide these elements when the confirmation is being shown *@
@* { *@
@*     <div> *@
@*         <label for="location">Choose a location:</label> *@
@*         <select @onchange="HandleLocationChange" id="location"> *@
@*             <option value="">Select a location</option> *@
@*             @foreach (var location in locations) *@
@*             { *@
@*                 <option value="@location.Detail">@location.Name</option> *@
@*             } *@
@*         </select> *@
@*     </div> *@
@* *@
@*     <div> *@
@*         <label for="specialization">Choose a specialization:</label> *@
@*         <select @onchange="HandleSpecializationChange" id="specialization"> *@
@*             <option value="">Select a specialization</option> *@
@*             @foreach (var spec in specializations) *@
@*             { *@
@*                 <option value="@spec">@spec</option> *@
@*             } *@
@*         </select> *@
@*     </div> *@
@* *@
@*     @if (selectedLocation != null && selectedSpecialization != null && !showDatePicker && !showTimeSlots) *@
@*     { *@
@*         <button class="btn btn-primary" @onclick="GoToSelectDate">Next</button> *@
@*     } *@
@* } *@
@* *@
@* @if (showDatePicker) *@
@* { *@
@*     <div> *@
@*         <label for="appointmentDate">Select a date for your appointment:</label> *@
@*         <input type="date" id="appointmentDate" @onchange="HandleDateChange" /> *@
@*         <button class="btn btn-primary" @onclick="ConfirmDate">Next</button> *@
@*     </div> *@
@* } *@
@* *@
@* @if (showTimeSlots) *@
@* { *@
@*     $1$ <div> #1# *@
@*     $1$     <label>Select a time slot:</label> #1# *@
@*     $1$     @foreach (TimeSpan time in availableTimeSlots) #1# *@
@*     $1$     { #1# *@
@*     $1$         <button class="btn btn-outline-primary" @onclick="() => SelectTimeSlot(time)">@time</button> #1# *@
@*     $1$     } #1# *@
@*     $1$ </div> #1# *@
@* } *@
@* *@
@* @if (showConfirmation) *@
@* { *@
@*     <div> *@
@*         <h4>Review and Confirm Your Appointment</h4> *@
@*         <p>Location: @selectedLocation</p> *@
@*         <p>Specialization: @selectedSpecialization</p> *@
@*         <p>Date: @selectedDate.Value.ToString("yyyy-MM-dd")</p> *@
@*         <p>Time: @selectedTimeSlot</p> *@
@*         <button class="btn btn-success" @onclick="CreateAppointment">Confirm</button> *@
@*         <button class="btn btn-secondary" @onclick="GoBack">Go Back</button> *@
@*     </div> *@
@* } *@
@* *@
@* @if (bookingConfirmed) *@
@* { *@
@*     <p>Appointment booked successfully!</p> *@
@* } *@
@* *@
@* @code { *@
@*     private List<(string Name, string Detail)> locations = new List<(string Name, string Detail)> *@
@*     { *@
@*         ("Hospital North", "1234 North St, City A"), *@
@*         ("Clinic Central", "5678 Central Blvd, City B"), *@
@*         ("Health Center South", "91011 South Ave, City C") *@
@*     }; *@
@* *@
@*     private List<string> specializations = new List<string> { "Cardiologist", "Gynecologist", "Family Doctor" }; *@
@*     private List<string> availableTimeSlots = new List<string> { "10:00", "10:30", "12:00" }; *@
@* *@
@*     private string selectedLocation; *@
@*     private string selectedSpecialization; *@
@*     private bool showDatePicker = false; *@
@*     private bool showTimeSlots = false; *@
@*     private bool showConfirmation = false; *@
@*     private bool bookingConfirmed = false; *@
@*     private DateTime? selectedDate; *@
@*     private TimeSpan selectedTimeSlot; *@
@* *@
@*      *@
@*     private async Task CreateAppointment() *@
@*     { *@
@*         var createAppointmentDto = new AppointmentDto *@
@*         { *@
@*             AppointmentId = 0, *@
@*             DoctorId = "000", // Replace with logic to fetch doctor ID *@
@*             Date = selectedDate ?? DateTime.MinValue, *@
@*             Time = selectedTimeSlot, *@
@*             City = selectedLocation, *@
@*             Status = "Pending", *@
@*             Description = $"Appointment with a {selectedSpecialization}", *@
@*             PatientCpr = "1234567" // Replace with the actual patient's CPR *@
@*         }; *@
@*         try *@
@*         { *@
@*             await AppointmentService.CreateAppointment(createAppointmentDto); *@
@* *@
@*         } *@
@*         catch (Exception e) *@
@* *@
@*         { *@
@*             Console.Error.WriteLine($"Error creating an APPOINTMENT{e.Message}"); *@
@* *@
@*         } *@
@*         ConfirmAppointment(); *@
@*     } *@
@*      *@
@*     private void HandleLocationChange(ChangeEventArgs e) *@
@*     { *@
@*         selectedLocation = e.Value.ToString(); *@
@*         CheckForNextStep(); *@
@*     } *@
@* *@
@*     private void HandleSpecializationChange(ChangeEventArgs e) *@
@*     { *@
@*         selectedSpecialization = e.Value.ToString(); *@
@*         CheckForNextStep(); *@
@*     } *@
@* *@
@*     private void CheckForNextStep() *@
@*     { *@
@*         if (!string.IsNullOrEmpty(selectedLocation) && !string.IsNullOrEmpty(selectedSpecialization) && !showDatePicker) *@
@*         { *@
@*             showDatePicker = true; *@
@*         } *@
@*     } *@
@* *@
@*     private void GoToSelectDate() *@
@*     { *@
@*         showDatePicker = true; *@
@*     } *@
@* *@
@*     private void ConfirmDate() *@
@*     { *@
@*         showDatePicker = false; *@
@*         showTimeSlots = true; // Proceed to time slot selection *@
@*     } *@
@* *@
@*     private void HandleDateChange(ChangeEventArgs e) *@
@*     { *@
@*         if (DateTime.TryParse(e.Value.ToString(), out var date)) *@
@*         { *@
@*             selectedDate = date; *@
@*         } *@
@*     } *@
@* *@
@*     private void SelectTimeSlot(TimeSpan time) *@
@*     { *@
@*         selectedTimeSlot = time; *@
@*         showTimeSlots = false; *@
@*         showConfirmation = true; // Move to confirmation *@
@*     } *@
@* *@
@*     private void ConfirmAppointment() *@
@*     { *@
@*         showConfirmation = false; *@
@*         bookingConfirmed = true; // Display the booking success message *@
@*     } *@
@* *@
@*     private void GoBack() *@
@*     { *@
@*         showConfirmation = false; *@
@*         showDatePicker = true; // Allow the user to select the date again *@
@*     } *@
@* } *@
